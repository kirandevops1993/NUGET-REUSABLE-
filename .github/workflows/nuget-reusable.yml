name: Reusable Workflow

on:
  workflow_call:
    inputs:
      solution:
        required: true
        type: string
      nugetConfigPath:
        required: true
        type: string
      restoreMode:
        required: true
        type: string
      noCache:
        required: true
        type: boolean
      nuGetRestoreArgs:
        required: true
        type: string
      verbosity:
        required: true
        type: string
      searchPattern:
        required: true
        type: string
      outputdir:
        required: true
        type: string
      versionByBuild:
        required: true
        type: boolean
      versionEnvVar:
        required: true
        type: string
      configurationToPack:
        required: true
        type: string
      buildProperties:
        required: true
        type: string
      nuGetAdditionalArgs:
        required: true
        type: string
      nuGetFeedType:
        required: true
        type: string
      feedName:
        required: true
        type: string

jobs:
  nuget-restore:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Restore NuGet Packages
        run: |
          dotnet restore ${{ inputs.solution }} --configfile ${{ inputs.nugetConfigPath }} \
          --verbosity ${{ inputs.verbosity }} ${{ inputs.nuGetRestoreArgs }}

  nuget-pack:
    runs-on: ubuntu-latest
    needs: nuget-restore
    steps:
      - name: Pack NuGet Package
        run: |
          dotnet pack ${{ inputs.searchPattern }} --output ${{ inputs.outputdir }} \
          --configuration ${{ inputs.configurationToPack }} \
          --property ${{ inputs.buildProperties }} ${{ inputs.nuGetAdditionalArgs }}

  nuget-publish:
    runs-on: ubuntu-latest
    needs: nuget-pack
    steps:
      - name: Publish NuGet Package
        run: |
          dotnet nuget push ${{ inputs.outputdir }}/*.nupkg --source ${{ inputs.feedName }} \
          ${{ inputs.nuGetAdditionalArgs }}
